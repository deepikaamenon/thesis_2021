##Sla1 and sla1_delrvs movement with and without sorbitol
#plot the data generated by the alignment

# sla1 for different strains are loaded with abp from (reverse) two color alignment as the t_max, first 125 time points for y0 
#library(ggplot2)
#library("RColorBrewer")
source("/Volumes/MarkoKaksonenLab/Deepika/data_desktop/Doc/align_tracks.R")
#cols<-brewer.pal(9, "PuBu")

#RVS from SC data
get(load("/Volumes/MarkoKaksonenLab/Deepika/data_desktop/Tracking/SC/diploid/Rvs167/2017_07_07/4dx5b/tracks.Rdata"))->Rvs4x
get(load("/Volumes/MarkoKaksonenLab/Deepika/data_desktop/Tracking/SC/diploid/Rvs167/2017_07_07/2832x3132/tracks.Rdata"))->Rvs2x
get(load("/Volumes/MarkoKaksonenLab/Deepika/data_desktop/Tracking/SC/diploid/Rvs167/2017_07_07/529x551/motile.Rdata"))->Rvs1x

#Sla1 from SC data

#get(load("/Volumes/MarkoKaksonenLab/Deepika/data_desktop/Tracking/SC/WT/sla1egfp/2017_06_12_823/tracks_blue.Rdata"))->wtsla12017
#get(load("/Volumes/MarkoKaksonenLab/Deepika/data_desktop/Tracking/SC/Rvsduplication/Sla1/2017_06_12_161d100_167d100_823_5a/tracks_green.Rdata"))->rvsdup_sla1
#sla1 from duplication diploid data
get(load("/Volumes/MarkoKaksonenLab/Deepika/data_desktop/Tracking/SC/diploid/sla1/2017_10_27_5ax4drvsdup_diploid/5ax4d/tracks.Rdata"))->Sla14x
get(load("/Volumes/MarkoKaksonenLab/Deepika/data_desktop/Tracking/SC/diploid/sla1/2017_08_16_823x822/822x823/tracks.Rdata"))->Sla12x_2xsla1
get(load("/Volumes/MarkoKaksonenLab/Deepika/data_desktop/Tracking/SC/diploid/sla1/2017_06_12_823x100diploid/tracks.Rdata"))->Sla12x
get(load("/Volumes/MarkoKaksonenLab/Deepika/data_desktop/Tracking/SC/diploid/sla1/2018_04_10/tracks.Rdata"))->rvs1x_1316x531


#sla1 from haploids
get(load("/Volumes/MarkoKaksonenLab/Deepika/data_desktop/Tracking/SC/delrvs167/delrvs_sla1_0531/wo_treatment/analysis_1_2p/tracks.Rdata"))->delrvs_sla1_notrans
get(load("/Volumes/MarkoKaksonenLab/Deepika/data_desktop/Tracking/SC/rvs_delsh3/rvs167_delsh3_sla1_egfp/2015_04_02/tracks.Rdata"))->delsh3_sla1_notrans
#2104_11_05/tracks.Rdata
print("ok")

#abp from alignment of Rvs SC to Rvs-abp DC _ W2.data
get(load("/Volumes/MarkoKaksonenLab/Deepika/data_desktop/Tracking/DC/diploids/2018_02_21/4xrvs/rvsgfpdup4x_W2.Rdata"))->abp_notrans_4x
get(load("/Volumes/MarkoKaksonenLab/Deepika/data_desktop/Tracking/DC/diploids/2018_02_21/3132x3131/rvsgfp2x_W2.Rdata"))->abp_notrans_2x
get(load("/Users/kaksonenlab/Desktop/dm/rvsgfp1x_W2.Rdata"))->abp_notrans_1x

#abp from alignment of sla1 SC to sla1-abp DC _ W2.data
get(load("/Volumes/MarkoKaksonenLab/Deepika/data_desktop/Tracking/DC/diploids/sla1/2018_04_18/5ax4d_rvsdup4x_823/rvsgfpdup4x_sla1_W2.Rdata"))->abp_sla1notrans_4x
get(load("/Volumes/MarkoKaksonenLab/Deepika/data_desktop/Tracking/DC/diploids/sla1/2018_04_18/822x823/rvs2x_sla1_W2.Rdata"))->abp_sla1notrans_2x_2xsla1
get(load("/Volumes/MarkoKaksonenLab/Deepika/data_desktop/Tracking/DC/diploids/sla1/2018_04_18/823x100/rvs2x_sla1_W2.Rdata"))->abp_sla1notrans_2x
#get(load("/Volumes/MarkoKaksonenLab/Deepika/data_desktop/Tracking/DC/diploids/sla1/2018_04_18/"))->abp_sla1notrans_1x



#generate a template transformation matrix to fool gen.data
get(load("/Volumes/MarkoKaksonenLab/Deepika/data_desktop/Tracking/DC/wt/Rvs167/110824_mytrasf.Rdata"))->transformation_template
transformation_template<-0*transformation_template

## get t0 from max abp1 intensities for each trace
abp_notrans_4x[which(abp_notrans_4x[,"mean_sFI"]==max(abp_notrans_4x[,"mean_sFI"],na.rm=TRUE)),"mean_t"]->t0_abp_4x
abp_notrans_2x[which(abp_notrans_2x[,"mean_sFI"]==max(abp_notrans_2x[,"mean_sFI"],na.rm=TRUE)),"mean_t"]->t0_abp_2x
abp_notrans_1x[which(abp_notrans_1x[,"mean_sFI"]==max(abp_notrans_1x[,"mean_sFI"],na.rm=TRUE)),"mean_t"]->t0_abp_1x

abp_sla1notrans_4x[which(abp_sla1notrans_4x[,"mean_sFI"]==max(abp_sla1notrans_4x[,"mean_sFI"],na.rm=TRUE)),"mean_t"]->t0_abp_sla14x
abp_sla1notrans_2x[which(abp_sla1notrans_2x[,"mean_sFI"]==max(abp_sla1notrans_2x[,"mean_sFI"],na.rm=TRUE)),"mean_t"]->t0_abp_sla12x

#t0_abp_2x=t0_abp_2x-3.75
#output nice and usable data using gen.data
#sla1 is shifted in time by the abp max intensity, no shift in y
#rvs4x<-gen.data(Rvs4x,transformation_template,n=NA,sn=NA, zero=0, t0=t0_abp_4x)
#rvs2x<-gen.data(Rvs2x,transformation_template,n=NA,sn=NA,zero=0, t0=t0_abp_2x )


rvs4x<-gen.data(Rvs4x,transformation_template,n=63.7 ,sn=5.5,t0=t0_abp_4x)
rvs2x<-gen.data(Rvs2x,transformation_template,n=55.9,sn=4.6, t0=t0_abp_2x)


sla14x<-gen.data(Sla14x,transformation_template,n=150 ,sn=5.5,t0=t0_abp_sla14x)
sla12x<-gen.data(Sla12x,transformation_template,n=150,sn=5.5, t0=t0_abp_sla12x)
sla12x_2xsla1<-gen.data(Sla12x_2xsla1,transformation_template,n=150,sn=5.5, t0=t0_abp_sla12x)
sla1diploid_rvs1x<-gen.data(rvs1x_1316x531,transformation_template,n=NA,sn=NA)
##made up the sla1 numbers

rvs1x<-gen.data(Rvs1x,transformation_template,n=44.8 ,sn=4.7)
#rvsmismatch<-gen.data(rvs_mismatch7x3131_diploid,transformation_template,n=NA ,sn=NA)

#abp is shifted in t by max of its intensity peak
abp4x<-gen.data(abp_notrans_4x,NULL,n=124.1,sn=16.3,rescale.n=1, t0=t0_abp_4x)
abp2x<-gen.data(abp_notrans_2x,NULL,n=131.4,sn=15.8,rescale.n=1,t0=t0_abp_2x)
abp1x<-gen.data(abp_notrans_1x,NULL,n=126.5,sn=20.1,rescale.n=1,t0=t0_abp_1x)

abpsla14x<-gen.data(abp_sla1notrans_4x,NULL,n=124.1,sn=16.3,rescale.n=1, t0=t0_abp_sla14x)
abpsla12x<-gen.data(abp_sla1notrans_2x,NULL,n=131.4,sn=15.8,rescale.n=1,t0=t0_abp_sla12x)

print("genok")
#abp1 in 3131x3132= 229.4 ?? 25.1
#abp1 in 2832x3131 =131.4 ?? 15.8 (second )
#abp1 in 4dx5b second set =124.1 ?? 16.3
#abp1 in 4dx5b first set = 210.8 ?? 52.8

#set first time point to 0 
## or is already done by aligning sla1 to the abp1 peak
#t1=sla1_wt[,"t"]-sla1_wt[1,"t"]
#t2=sla1_sorb[,"t"]-sla1_sorb[1,"t"]
#t3=delrvs_sla1[,"t"]-delrvs_sla1[1,"t"]
#t4=delrvs_sla1_sorb[,"t"]-delrvs_sla1_sorb[1,"t"]
#t5=delrvs_abp[,"t"]-delrvs_sla1[1,"t"]
#t6=delrvs_abp_sorb[,"t"]-delrvs_sla1_sorb[1,"t"]
#t7=abp_sorb[,"t"]-sla1_sorb[1,"t"]
t_diploid1x=sla1diploid_rvs1x[,"t"]-sla1diploid_rvs1x[1,"t"]

#set initial y position to 0
rvs4x_x0<-mean(rvs4x[1:5,"x"])
rvs2x_x0<-mean(rvs2x[1:5,"x"])
rvs1x_x0<-mean(rvs1x[1:5,"x"])
abp4x_x0<-mean(abp4x[1:10,"x"])
abp2x_x0<-mean(abp2x[1:10,"x"])
abp1x_x0<-mean(abp1x[1:10,"x"])

sla14x_x0<-mean(sla14x[1:10,"x"])
sla12x_x0<-mean(sla12x[1:10,"x"])
sla12x_2xsla1_x0<-mean(sla12x_2xsla1[1:10,"x"])
x_sla1diploid_rvs1x<-mean(sla1diploid_rvs1x[1:25, "x"])
abpsla14x_x0<-mean(abpsla14x[1:10,"x"])
abpsla12x_x0<-mean(abpsla12x[1:10,"x"])

mnorm<-function(x) return((x-min(x,na.rm=T))/(max(x,na.rm=T)-min(x,na.rm=T)))


#plot them, with t0= max of corresponding abp peak
pdf("Rvsdup_DC_newabpmolecunumbers_all12_rvspeakalign201807_w1x.pdf")
#all the sla1s
myplot(rvs4x[,"t"],rvs4x[,"x"]-rvs4x_x0,rvs4x[,"t.err"],rvs4x[,"x.err"],line.col="#003300",xlab="Time (s)",ylab="Inward movement (nm)",line.lwd=3,deltat=0.25,xlim=c(-25,10),ylim=c(-25,200))
myplot(rvs2x[,"t"],rvs2x[,"x"]-rvs2x_x0,rvs2x[,"t.err"],rvs2x[,"x.err"],line.col="#669900",hold_on=TRUE,line.lwd=3,deltat=0.25)
myplot(sla14x[,"t"],sla14x[,"x"]-sla14x_x0,sla14x[,"t.err"],sla14x[,"x.err"],line.col="#82dad7",hold_on=TRUE,line.lwd=3,deltat=0.25)
myplot(sla12x[,"t"],sla12x[,"x"]-sla12x_x0,sla12x[,"t.err"],sla12x[,"x.err"],line.col="#000033",hold_on=TRUE,line.lwd=3,deltat=0.25)
myplot(rvs1x[,"t"],rvs1x[,"x"]-rvs1x_x0,rvs1x[,"t.err"],rvs1x[,"x.err"],line.col="#A69732",hold_on=TRUE,line.lwd=3,deltat=0.25)

myplot(t_diploid1x-22.3,sla1diploid_rvs1x[,"x"]-x_sla1diploid_rvs1x,sla1diploid_rvs1x[,"t.err"],sla1diploid_rvs1x[,"x.err"],line.col="#000000",hold_on=TRUE,line.lwd=3,deltat=0.25)
#myplot(sla12x_2xsla1[,"t"]+1.8,sla12x_2xsla1[,"x"]-sla12x_2xsla1_x0,sla12x_2xsla1[,"t.err"],sla12x_2xsla1[,"x.err"],line.col="#000066",hold_on=TRUE,line.lwd=3,deltat=0.25)


legend("topleft",c("Rvs4x", "Rvs2x", "sla14x", "sla12x 1/2 sla1 tagged"),lty=1,col=c('#003300','#669900',"#82dad7", "#000033"),bty='n', cex=0.75)
title(main="Rvs in diploids", sub=" t0= abp max")

#alignment of each

#myplot(t_rvs_dup,rvs_dup[,"n"],rvs_dup[,"t.err"],rvs_dup[,"n.err"],line.col="#00FFFF",xlab="time(s)",ylab="# molecules",xlim=c(-1.5,8), ylim=c(0,200))

myplot(abp4x[,"t"],abp4x[,"n"],abp4x[,"t.err"],abp4x[,"n.err"],line.col="#990000",xlab="Time (s)",ylab="Fl.Intensity (a.u)",line.lwd=3,deltat=0.45,xlim=c(-10,7),ylim=c(0,400))
myplot(rvs4x[,"t"],rvs4x[,"n"],rvs4x[,"t.err"],rvs4x[,"n.err"],line.col="#003300",hold_on=TRUE,line.lwd=3,deltat=0.45)

title(main="4xRvs", sub=" t0= abp max")

myplot(abp2x[,"t"],abp2x[,"n"],abp2x[,"t.err"],abp2x[,"n.err"],line.col="#CC0066",hold_on=TRUE,line.lwd=3,deltat=0.45)
myplot(rvs2x[,"t"],rvs2x[,"n"],rvs2x[,"t.err"],rvs2x[,"n.err"],line.col="#669900",hold_on=TRUE,line.lwd=3,deltat=0.45)

myplot(abp1x[,"t"],abp1x[,"n"],abp1x[,"t.err"],abp1x[,"n.err"],line.col="#CC7E00",hold_on=TRUE,line.lwd=3,deltat=0.45)
myplot(rvs1x[,"t"],rvs1x[,"n"],rvs1x[,"t.err"],rvs1x[,"n.err"],line.col="#A69732",hold_on=TRUE,line.lwd=3,deltat=0.45)


title(main="2xRvs", sub=" t0= abp max")

#intensities
myplot(abp4x[,"t"],abp4x[,"n"],abp4x[,"t.err"],abp4x[,"n.err"],line.col="#FFFFFF",xlab="Time (s)",ylab="Fl.Intensity (a.u)",line.lwd=3,deltat=0.45,xlim=c(-30,7),ylim=c(0,400))
#myplot(abp2x[,"t"],abp2x[,"n"],abp2x[,"t.err"],abp2x[,"n.err"],line.col="#CC0066",hold_on=TRUE,line.lwd=3,deltat=0.45)
myplot(rvs4x[,"t"],rvs4x[,"n"],rvs4x[,"t.err"],rvs4x[,"n.err"],line.col="#003300",hold_on=TRUE,line.lwd=3,deltat=0.45)
myplot(rvs2x[,"t"],rvs2x[,"n"],rvs2x[,"t.err"],rvs2x[,"n.err"],line.col="#669900",hold_on=TRUE,line.lwd=3,deltat=0.45)
#myplot(abpsla14x[,"t"],abpsla14x[,"n"],abpsla14x[,"t.err"],abpsla14x[,"n.err"],line.col="#FF6600",hold_on=TRUE,line.lwd=3,deltat=0.45)
#myplot(abpsla12x[,"t"],abpsla12x[,"n"],abpsla12x[,"t.err"],abpsla12x[,"n.err"],line.col="#FFCC33",hold_on=TRUE,line.lwd=3,deltat=0.45)
myplot(sla14x[,"t"],sla14x[,"n"],sla14x[,"t.err"],sla14x[,"n.err"],line.col="#82dad7",hold_on=TRUE,line.lwd=3,deltat=0.45)
myplot(sla12x[,"t"],sla12x[,"n"],sla12x[,"t.err"],sla12x[,"n.err"],line.col="#000033",hold_on=TRUE,line.lwd=3,deltat=0.45)

legend("topleft",c("abp4x", "abp2x", "Rvs4x", "Rvs2x", "abp4x_sla1", "abp2x_sla1", "sla14x", "sla12x"),lty=1,col=c('#990000','#CC0066','#FF6600', '#FFCC33', "#82dad7", "#000033"),bty='n', cex=0.75)
title(main="abp1 fl.int", sub="t0= maxima for each average trace")

#intensities with numbers
#myplot(rvs_del51b[,"t"],rvs_del51b[,"n"],rvs_del51b[,"t.err"],rvs_del51b[,"n.err"],line.col="#FFFFFF",line.lwd=3,deltat=0.25, xlim=c(-6,4), ylim=c(-2,150),las=1, bty="n", cex.axis=1.5)

myplot(abp4x[,"t"],abp4x[,"n"],abp4x[,"t.err"],abp4x[,"n.err"],line.col="#990000",xlab="Time (s)",ylab="Fl.Intensity (a.u)",line.lwd=3,deltat=0.45,xlim=c(-10,7),ylim=c(0,400))
myplot(abp2x[,"t"],abp2x[,"n"],abp2x[,"t.err"],abp2x[,"n.err"],line.col="#CC0066",hold_on=TRUE,line.lwd=3,deltat=0.45)
#myplot(rvs4x[,"t"]+0.25,mnorm(rvs4x[,"fi"]),rvs4x[,"t.err"],rvs4x[,"fi.err"],line.col="#003300",xlab="Time (s)",ylab="Inward movement (nm)",hold_on=TRUE,line.lwd=3,deltat=0.45)
#myplot(rvs2x[,"t"],mnorm(rvs2x[,"fi"]),rvs2x[,"t.err"],rvs2x[,"fi.err"],line.col="#669900",xlab="Time (s)",ylab="Inward movement (nm)",hold_on=TRUE,line.lwd=3,deltat=0.45)

legend("topleft",c("abp4x", "abp2x", "Rvs4x", "Rvs2x"),lty=1,col=c('#990000','#CC0066','#003300', '#669900'),bty='n', cex=0.75)
title(main="abp1 fl.int", sub="t0= maxima for each average trace")

#sla1 vs abp

myplot(abpsla14x[,"t"],abpsla14x[,"n"],abpsla14x[,"t.err"],abpsla14x[,"n.err"],line.col="#FF6600",xlab="Time (s)",ylab="Fl.Intensity (a.u)",line.lwd=3,deltat=0.45,xlim=c(-30,30),ylim=c(0,400))
myplot(sla14x[,"t"],sla14x[,"n"],sla14x[,"t.err"],sla14x[,"n.err"],line.col="#82dad7",hold_on=TRUE,line.lwd=3,deltat=0.45)
myplot(rvs4x[,"t"],rvs4x[,"n"],rvs4x[,"t.err"],rvs4x[,"n.err"],line.col="#003300",hold_on=TRUE,line.lwd=3,deltat=0.45)
myplot(abp4x[,"t"],abp4x[,"n"],abp4x[,"t.err"],abp4x[,"n.err"],line.col="#990000",hold_on=TRUE, line.lwd=3,deltat=0.45)

legend("topleft",c("abp4x",  "sla14x"),lty=1,col=c("#FF6600","#82dad7"),bty='n', cex=0.75)

myplot(abpsla12x[,"t"],abpsla12x[,"n"],abpsla12x[,"t.err"],abpsla12x[,"n.err"],line.col="#FFCC33",xlab="Time (s)",ylab="Fl.Intensity (a.u)",line.lwd=3,deltat=0.45,xlim=c(-30,30),ylim=c(0,400))
myplot(sla12x[,"t"],sla12x[,"n"],sla12x[,"t.err"],sla12x[,"n.err"],line.col="#000033",hold_on=TRUE,line.lwd=3,deltat=0.45)
myplot(rvs2x[,"t"],rvs2x[,"n"],rvs2x[,"t.err"],rvs2x[,"n.err"],line.col="#669900",hold_on=TRUE,line.lwd=3,deltat=0.45)
myplot(abp2x[,"t"],abp2x[,"n"],abp2x[,"t.err"],abp2x[,"n.err"],line.col="#CC0066",hold_on=TRUE,line.lwd=3,deltat=0.45)

legend("topleft",c("abp2x",  "sla12x"),lty=1,col=c("#FFCC33","#000033"),bty='n', cex=0.75)
title(main="abp1 fl.int", sub="t0= maxima for each average trace")


#all the abps
myplot(abp4x[,"t"],abp4x[,"x"]-abp4x_x0, abp4x[,"t.err"],abp4x[,"x.err"],line.col="#990000",xlab="Time (s)",ylab="Inward movement (nm)",line.lwd=3,deltat=0.25,xlim=c(-10,7),ylim=c(-50,150))
myplot(abp2x[,"t"],abp2x[,"x"]-abp2x_x0, abp2x[,"t.err"],abp2x[,"x.err"],line.col="#CC0066",hold_on=TRUE,line.lwd=3,deltat=0.25)
myplot(abpsla14x[,"t"],abpsla14x[,"x"]-abpsla14x_x0, abpsla14x[,"t.err"],abpsla14x[,"x.err"],line.col="#FF6600",hold_on=TRUE,line.lwd=3,deltat=0.25)
myplot(abpsla12x[,"t"],abpsla12x[,"x"]-abpsla12x_x0, abpsla12x[,"t.err"],abpsla12x[,"x.err"],line.col="#FFCC33",hold_on=TRUE,line.lwd=3,deltat=0.25)

title(main="abp1 in Rvs dupl diploids", sub="t0= maxima for each average trace")
legend("topleft",c("abp4x", "abp2x"),lty=1,col=c('#990000','#FF3300'),bty='n', cex=0.75)

#all the abp intensities
myplot(abpsla12x[,"t"],abpsla12x[,"n"],abpsla12x[,"t.err"],abpsla12x[,"n.err"],line.col="#FFCC33",xlab="Time (s)",ylab="Fl.Intensity (a.u)",line.lwd=3,deltat=0.45,xlim=c(-20,20),ylim=c(0,300))
#myplot(abpsla14x[,"t"],abpsla14x[,"n"],abpsla14x[,"t.err"],abpsla14x[,"n.err"],line.col="#FF6600",hold_on=TRUE,line.lwd=3,deltat=0.45,xlim=c(-30,30),ylim=c(0,400))
#myplot(abp4x[,"t"],abp4x[,"n"],abp4x[,"t.err"],abp4x[,"n.err"],line.col="#990000",hold_on=TRUE, line.lwd=3,deltat=0.45)
myplot(abp2x[,"t"],abp2x[,"n"],abp2x[,"t.err"],abp2x[,"n.err"],line.col="#CC0066",hold_on=TRUE,line.lwd=3,deltat=0.45)
legend("topleft",c("abp2x sla1",  "abp2x"),lty=1,col=c("#FFCC33", "#CC0066"),bty='n', cex=0.75)

myplot(abpsla12x[,"t"],abpsla12x[,"n"],abpsla12x[,"t.err"],abpsla12x[,"n.err"],line.col="#FFFFFF",xlab="Time (s)",ylab="Fl.Intensity (a.u)",line.lwd=3,deltat=0.45,xlim=c(-20,20),ylim=c(0,300))
myplot(abpsla14x[,"t"],abpsla14x[,"n"],abpsla14x[,"t.err"],abpsla14x[,"n.err"],line.col="#FF6600",hold_on=TRUE,line.lwd=3,deltat=0.45,xlim=c(-30,30),ylim=c(0,400))
myplot(abp4x[,"t"],abp4x[,"n"],abp4x[,"t.err"],abp4x[,"n.err"],line.col="#990000",hold_on=TRUE, line.lwd=3,deltat=0.45)
#myplot(abp2x[,"t"],abp2x[,"n"],abp2x[,"t.err"],abp2x[,"n.err"],line.col="#CC0066",hold_on=TRUE,line.lwd=3,deltat=0.45)
legend("topleft",c("abp4x sla1", "abp4x"),lty=1,col=c( "#FF6600",'#990000'),bty='n', cex=0.75)

dev.off()


